<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Scaffold Overmind</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" />
</head>

<body style="background-color: #444">
    <div>
        <nav class="navbar navbar-default" style="background-color: #222">
            <div class="container-fluid">
                <div class="navbar-header" id="conn-status">
                    <span v-bind:class="status_class"><span id="conn-icon">‚óè</span> {{status}}</span>
                    {{path}}
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row" style="margin-left: 0">
                <div id="sidepanel" class="col-md-4" style="background-color: #333; height: 100%; box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)">
                    <pane-control name="Plan" v-bind:active="active_pane" v-on:change="update_pane"></pane-control>

                    <table class="table">
                        <tr>
                            <th></th>
                            <th>free</th>
                            <th>in transit</th>
                            <th>fixed</th>
                        </tr>
                        <tr>
                            <td>RS</td>
                            <td>3</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr>
                            <td>RH</td>
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr>
                            <td>RR</td>
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr>
                            <td>screw</td>
                            <td>10</td>
                            <td>1</td>
                            <td>0</td>
                        </tr>
                    </table>

                    <pane-control name="Workers" v-bind:active="active_pane" v-on:change="update_pane"></pane-control>
                    <div id="workers">
                        <div class="panel panel-info" v-for="worker in worker_pool.workers">
                            <div class="panel-heading">
                                <h2 class="panel-title"><img width="25" height="25" v-bind:src="'data:image/png;base64,' + worker.identicon.toString()"/> {{worker.wtype}} <span style="font-size:80%; color: lightgray">{{worker.addr}}</span></h2>
                            </div>
                            <div class="panel-body">
                                <div>
                                    Carrying RS
                                </div>
                            </div>
                        </div>
                        <div v-bind:class="{'alert': true, 'alert-info': !has_uninit, 'alert-danger': has_uninit}" role="alert">{{uninit_desc}}</div>
                    </div>
                </div>

                <div class="col-md-8">
                    <div id="tab_plan">
                        <button id="add_rs" class="btn btn-default">+RS</button> Make it DnD
                        <div id="viewport"></div>
                    </div>

                    <div id="tab_workers" style="display: none">
                        <div class="btn-group dropdown">
                            <button v-on:click='update_info' class="btn btn-default" title="refresh now">
                              <span class="glyphicon glyphicon-refresh"></span>
                            </button>
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              <span class="caret"></span>
                              <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a href="#">Refresh every 5sec</a></li>
                                <li><a href="#">Refresh every 15sec</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="#">Disable Auto-refresh</a></li>
                            </ul>
                        </div>

                        <button class="btn btn-warning" title="Show raw actions">
                          <span class="glyphicon glyphicon-warning-sign"></span>Show raw actions
                        </button>


                        <div class="panel panel-info" v-for="worker in workers">
                            <div class="panel-heading">
                                <h3 class="panel-title">Worker <img width="50" height="50" v-bind:src="'data:image/png;base64,' + worker.identicon.toString()"/><span style="font-size:80%; color: lightgray">{{worker.addr}}</span></h3>
                                <button v-on:click='update_info' class="btn btn-default" title="refresh now">
                                  <span class="glyphicon glyphicon-refresh"></span>
                                </button>
                            </div>
                            <div class="panel-body">
                                <div v-bind:class="worker.power.classes">
                                    <span class="glyphicon glyphicon-off"></span> {{worker.power.desc}}
                                </div>

                                Carrying: RS, screw<br/>

                                <button v-on:click='extend()' class="btn btn-default" title="Attach new rail and screw it. Run from origin.">
                            Extend
                          </button>

                                <button v-on:click='shorten()' class="btn btn-default" title="Remove rail and screw. Run from origin.">
                            Shorten
                          </button>


                                <!-- header -->
                                <div style="overflow:hidden">
                                    <div style="float:left">
                                        <h4>D</h4>
                                        <button v-on:click='d_up()' class="btn btn-default" title="update">
                                <span class="glyphicon glyphicon-arrow-up"></span>
                              </button>
                                        <br/>

                                        <button v-on:click='d_down()' class="btn btn-default" title="update">
                                <span class="glyphicon glyphicon-arrow-down"></span>
                              </button> {{worker.out[0][1]}}
                                        <br/>
                                        <button v-on:click='d_downdown()' class="btn btn-warning" title="update">
                                <span class="glyphicon glyphicon-arrow-down"></span>
                              </button>
                                    </div>

                                    <div style="float:left">
                                        <h4>SCR</h4>
                                        <button v-on:click='scr_up()' class="btn btn-default" title="update">
                                <span class="glyphicon glyphicon-arrow-up"></span>
                              </button>
                                        <br/>
                                        <button v-on:click='scr_down()' class="btn btn-default" title="update">
                                <span class="glyphicon glyphicon-arrow-down"></span>
                              </button> {{worker.out[0][0]}}
                                    </div>

                                    <div style="float:left">
                                        <h4>S</h4> {{worker.out[1][2]}}
                                        <br/>

                                        <button v-on:click="command('e1s100')" class="btn btn-default" title="unfasten screw">
                                unlock
                              </button>
                                        <button v-on:click="command('e1s0')" class="btn btn-default" title="stop screw">
                                <span class="glyphicon glyphicon-stop"></span>
                              </button>
                                        <button v-on:click="command('e1s-100')" class="btn btn-default" title="fasten screw">
                                lock
                              </button>
                                    </div>
                                </div>

                                <div>
                                    <h4>T</h4>
                                    <button v-on:click="command('e500t-70T30,1!t0')" class="btn btn-primary" title="Find origin forward(500ms)">
                              <span class="glyphicon glyphicon-arrow-up"></span>
                            </button>
                                    <button v-on:click='t_step_f()' class="btn btn-default" title="go forward for a moment">
                              <span class="glyphicon glyphicon-arrow-up"></span>
                            </button> {{worker.out[1][0]}}
                                    <br/>
                                    <button v-on:click="command('e500t70T30,1!t0')" class="btn btn-primary" title="Find origin baclward(500ms)">
                              <span class="glyphicon glyphicon-arrow-down"></span>
                            </button>
                                    <button v-on:click='t_step_b()' class="btn btn-default" title="go backward for a moment">
                              <span class="glyphicon glyphicon-arrow-down"></span>
                            </button> O:{{worker.out[1][1]}}

                                    <line-chart :width="300" :height="200" :data="worker.readings"></line-chart>
                                </div>

                                <div class="panel" v-for="msg in worker.messages" v-bind:class="{'panel-default': msg.status == 'known', 'panel-warning': msg.status == 'unknown', 'panel-danger': msg.status == 'corrupt'}" v-bind:title="msg.desc">
                                    <div class="panel-heading">
                                        {{msg.timestamp}}<h3 class="panel-title">{{msg.head}}</h3>
                                    </div>
                                    <div v-if="msg.status != 'known'">
                                        <pre>{{msg.desc}}</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/86/three.min.js"></script>
    <script src="./3p/trackball.js"></script>
    <script src="./3p/STLLoader.js"></script>
    <script src="./app/build/bundle.js"></script>
</body>

</html>
